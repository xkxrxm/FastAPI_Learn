(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f7ddf9a8"],{"07a9":function(e,t,a){"use strict";a("3126")},3126:function(e,t,a){},"8e70":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-nav-bar",{attrs:{title:e.title[e.active],fixed:"","safe-area-inset-top":"",placeholder:""},on:{"click-left":e.onClickLeft}}),a("new-label",{directives:[{name:"show",rawName:"v-show",value:0==e.active,expression:"active == 0"}],on:{switchTab:e.handleSwitchTab}}),a("regist",{directives:[{name:"show",rawName:"v-show",value:1==e.active,expression:"active == 1"}],ref:"regist",on:{close:function(t){return e.handleNewLabel(0)}}}),a("query",{directives:[{name:"show",rawName:"v-show",value:2==e.active,expression:"active == 2"}],on:{close:e.handleClosePrint}}),a("van-tabbar",{model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[a("van-tabbar-item",{attrs:{icon:"orders-o"}},[e._v("标签管理")]),a("van-tabbar-item",{attrs:{icon:"home-o"}},[e._v("登记采集")]),a("van-tabbar-item",{attrs:{icon:"search"}},[e._v("查询")])],1),a("van-dialog",{attrs:{title:"采集模式设定","show-cancel-button":""},on:{confirm:e.confirmMode},model:{value:e.showMode,callback:function(t){e.showMode=t},expression:"showMode"}},[a("van-row",{staticStyle:{"margin-top":"0.5rem"}},[a("van-col",{attrs:{span:"10"}},[e._v("采集模式")]),a("van-col",{attrs:{span:"14"}},[a("van-radio-group",{attrs:{direction:"horizontal"},model:{value:e.form.mode,callback:function(t){e.$set(e.form,"mode",t)},expression:"form.mode"}},[a("van-radio",{attrs:{name:"1"}},[e._v("单采")]),a("van-radio",{attrs:{name:"2"}},[e._v("团采")])],1)],1)],1)],1)],1)},n=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-cell-group",{attrs:{title:""}},[a("van-row",{staticStyle:{padding:"0.5rem 0","text-align":"center"}},[a("van-col",{staticStyle:{"font-size":"1.1rem"},attrs:{span:"6"}},[e._v("分组数量")]),a("van-col",{attrs:{span:"6"}},[a("span",{staticStyle:{"font-size":"1.1rem",color:"#059b00"}},[e._v(e._s(e.counter.total))])]),a("van-col",{staticStyle:{"font-size":"1.1rem"},attrs:{span:"6"}},[e._v("已采集")]),a("van-col",{attrs:{span:"6"}},[a("span",{staticStyle:{"font-size":"1.1rem"}},[e._v(e._s(e.counter.current))])])],1)],1),a("van-field",{staticClass:"labelCode",attrs:{type:"number",label:"标签内容",readonly:""},model:{value:e.labelCode,callback:function(t){e.labelCode=t},expression:"labelCode"}}),a("van-cell-group",{attrs:{title:""}},[a("van-field",{attrs:{required:"",name:"zjhm",label:"身份证号",placeholder:"身份证号"},on:{input:e.handleInput},scopedSlots:e._u([{key:"button",fn:function(){return[a("van-button",{attrs:{size:"small",type:"primary"},on:{click:e.readInfo}},[e._v("扫二维码")])]},proxy:!0}]),model:{value:e.form.zjhm,callback:function(t){e.$set(e.form,"zjhm",t)},expression:"form.zjhm"}}),a("van-field",{attrs:{required:"",name:"name",label:"姓名",placeholder:"姓名"},model:{value:e.form.xm,callback:function(t){e.$set(e.form,"xm",t)},expression:"form.xm"}}),a("van-cell",{staticClass:"xb",staticStyle:{"text-align":"left"},attrs:{title:"性别"}},[a("van-radio-group",{attrs:{direction:"horizontal"},model:{value:e.form.xb,callback:function(t){e.$set(e.form,"xb",t)},expression:"form.xb"}},[a("van-radio",{attrs:{name:"1",shape:"square"}},[e._v("男")]),a("van-radio",{attrs:{name:"2",shape:"square"}},[e._v("女")])],1)],1),a("van-row",[a("van-col",{attrs:{span:"15"}},[a("van-field",{attrs:{readonly:"",type:"text",name:"birth",label:"出生日期",placeholder:"出生日期",clickable:"","right-icon":"arrow-down"},on:{"click-input":e.onClickCsrq,"click-right-icon":e.onClickCsrq},model:{value:e.form.csrq,callback:function(t){e.$set(e.form,"csrq",t)},expression:"form.csrq"}})],1),a("van-col",{attrs:{span:"9"}},[a("van-field",{staticClass:"nl",attrs:{name:"nl",required:"",type:"tel",label:"年龄",placeholder:"年龄"},model:{value:e.form.nl,callback:function(t){e.$set(e.form,"nl",t)},expression:"form.nl"}})],1)],1),a("van-field",{attrs:{type:"tel",required:"",name:"lxdh",label:"联系电话",placeholder:"联系电话"},model:{value:e.form.lxdh,callback:function(t){e.$set(e.form,"lxdh",t)},expression:"form.lxdh"}})],1),a("van-cell-group",{attrs:{title:""}},[a("van-field",{attrs:{required:"",name:"hjdz",label:"户籍地址",placeholder:"户籍地址"},model:{value:e.form.hjdz,callback:function(t){e.$set(e.form,"hjdz",t)},expression:"form.hjdz"}}),a("van-field",{attrs:{required:"",name:"jzdz",label:"居住地址",placeholder:"居住地址"},model:{value:e.form.jzdz,callback:function(t){e.$set(e.form,"jzdz",t)},expression:"form.jzdz"}})],1),a("van-cell-group",{attrs:{title:""}},[a("van-field",{attrs:{autosize:"",name:"bz",label:"备注",placeholder:"备注"},model:{value:e.form.bz,callback:function(t){e.$set(e.form,"bz",t)},expression:"form.bz"}})],1),a("van-cell-group",{attrs:{border:!1}},[a("div",{staticStyle:{margin:"0.1rem 1rem 0.4rem 1rem"}},[a("van-button",{attrs:{round:"",block:"",type:"info"},on:{click:e.onSubmit}},[e._v("登记")])],1)]),a("van-cell-group",{attrs:{border:!1}},[a("div",{staticStyle:{margin:"0.1rem 1rem 1rem 1rem"}},[a("van-button",{attrs:{round:"",block:"",plain:"",type:"danger"},on:{click:e.onFinish}},[e._v("结束当前分组")])],1)]),a("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.popers.csrq.show,callback:function(t){e.$set(e.popers.csrq,"show",t)},expression:"popers.csrq.show"}},[a("van-datetime-picker",{attrs:{type:"date",title:"选择出生日期","min-date":e.minDate,"max-date":e.maxDate,formatter:e.formatter},on:{confirm:e.confirmBirth,cancel:function(t){e.popers.csrq.show=!1}},model:{value:e.birthday,callback:function(t){e.birthday=t},expression:"birthday"}})],1),a("van-overlay",{attrs:{show:e.isSaving},on:{click:function(t){e.isSaving=!1}}},[a("div",{staticClass:"wrapper",on:{click:function(e){e.stopPropagation()}}},[a("van-loading",{attrs:{size:"2rem"}},[e._v("正在提交登记")])],1)])],1)},i=[],r=(a("a9e3"),a("ac1f"),a("5319"),a("365c"));function s(e){return 18==e.length}var c={name:"Regist",data:function(){return{isSaving:!1,birthday:new Date,minDate:new Date(1900,0,1),maxDate:new Date,labelCode:"",counter:{current:1,total:5},form:{rylb:"",zjhm:"",xm:"",xb:"",nl:"",csrq:"",dz:"",hjdz:"",jzdz:"",lxdh:"",cjry:window.sessionStorage.getItem("userid"),person_id:""},popers:{userType:{show:!1,options:[]},csrq:{show:!1}},readerIsReady:!1}},mounted:function(){var e=this;this.counter.total=window.localStorage.getItem("labelCount"),this.labelCode=window.localStorage.getItem("labelCode"),""==this.labelCode&&(this.$bus.$emit("labelCodeClear",""),this.$emit("close",0));var t=window.localStorage.getItem("labelCount")||5,a=window.localStorage.getItem("labelCounter")||0;this.counter.total=Number(t),this.counter.current=Number(a),this.$bus.$on("lableCodeChange",(function(t){e.labelCode=t,e.counter.current=0,window.localStorage.setItem("labelCounter",e.counter.current)})),this.$bus.$on("labelCountChange",(function(t){e.counter.total=t,e.counter.current=0,window.localStorage.setItem("labelCounter",e.counter.current)}))},watch:{"$store.state.bqsl":function(e){this.counter.total=Number(e),this.counter.current=0}},methods:{formatter:function(e,t){return"year"===e?"".concat(t,"年"):"month"===e?"".concat(t,"月"):t},readInfo:function(){var e=this;this.$dialog.alert({message:"原系统中，调起摄像头拍摄预约人员的二维码，获取预约人员信息，根据人员信息中的证件号码获取后台数据，填入页面，本系统中使用模拟数据"}).then((function(){""!==e.form.zjhm?e.getPersonInfo(e.form):e.$toast("请输入预约人员的身份证号码")}))},decode:function(e){var t=atob(e),a=decodeURI(t);return a},handleInput:function(e){if(18==e.length){var t=e.substr(6,8).replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"),a=e.substr(16,1);this.form.xb=a,this.form.csrq=t}},confirmBirth:function(e){console.log(e),this.popers.csrq.show=!1,this.form.csrq=this.$dayjs(this.birthday).format("YYYY-MM-DD")},onClickCsrq:function(){this.form.csrq&&(this.birthday=this.$dayjs(this.form.csrq).toDate()),this.popers.csrq.show=!0},getPersonInfo:function(e){var t=this;Object(r["d"])({zjhm:e.zjhm}).then((function(e){e?(e.csrq=t.$dayjs(e.csrq).format("YYYY-MM-DD"),Object.assign(t.form,e),t.form.person_id=e.id):console.log("未找到人员信息")}))},onSubmit:function(){var e=this;if(""==this.labelCode)return this.$toast("请先选择标签"),this.$bus.$emit("labelCodeClear",""),void this.$emit("close",0);if(""!=this.form.zjhm){var t=s(this.form.zjhm);if(t)if(""!=this.form.xm)if(""!=this.form.nl)if(""!=this.form.hjdz)if(""!=this.form.jzdz)if(""!=this.form.lxdh){var a=Object.assign({},this.form),o=window.localStorage.getItem("device-uuid");a=Object.assign(a,{bqbh:this.labelCode,bqxh:this.counter.current,csrq:this.$dayjs(this.form.csrq).format("YYYY-MM-DD 00:00:00"),sbid:o,cjdd:window.localStorage.getItem("cjdd")||""}),this.isSaving=!0,Object(r["b"])(a).then((function(t){e.isSaving=!1,t?(e.form={rylb:"",zjhm:"",xm:"",xb:"",nl:"",csrq:"",hjdz:"",jzdz:"",lxdh:"",person_id:""},e.$toast("登记成功"),e.counter.current==e.counter.total-1?(e.$bus.$emit("finishGather"),e.$bus.$emit("labelCodeClear",""),e.labelCode="",e.$emit("close",0)):(e.counter.current++,window.localStorage.setItem("labelCounter",e.counter.current))):(console.log("error"),e.$dialog.alert({title:"错误",message:t.msg||"登记失败"}))})).catch((function(t){e.isSaving=!1,e.$toast(t)}))}else this.$toast("联系电话不能为空");else this.$toast("居住地址不能为空");else this.$toast("户籍地址不能为空");else this.$toast("年龄不能为空");else this.$toast("姓名不能为空");else this.$toast("身份证号无效")}else this.$toast("身份证号不能为空")},onFinish:function(){var e=this;if(""==this.labelCode)return this.$toast("请先选择标签"),this.$bus.$emit("labelCodeClear",""),void this.$emit("close",0);this.$dialog.confirm({title:"提示",message:"是否结束当前分组"}).then((function(){window.localStorage.setItem("isGathering",0),e.form={rylb:"",zjhm:"",xm:"",xb:"",nl:"",csrq:"",dz:"",jzdz:"",lxdh:"",hjdz:"",person_id:""},e.$dialog.alert({title:"提示",message:"当前标签采集完毕"}).then((function(){e.$bus.$emit("finishGather"),e.$bus.$emit("labelCodeClear",""),e.labelCode="",e.$emit("close",0)}))})).catch((function(){}))}}},d=c,u=a("2877"),h=Object(u["a"])(d,l,i,!1,null,"8f9d81e6",null),m=h.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-search",{staticStyle:{position:"fixed",left:"0",top:"2rem",width:"100%","z-index":"99"},attrs:{round:"","show-action":"",placeholder:"请输入标签号"},on:{search:e.onSearch,cancel:e.onCancel},model:{value:e.labelCode,callback:function(t){e.labelCode=t},expression:"labelCode"}}),a("div",{staticStyle:{"overflow-y":"hidden","margin-top":"2.2rem","font-size":"1rem"}},[e._l(e.list,(function(t,o){return a("van-cell-group",{key:t.id},[a("van-row",{staticStyle:{padding:"0.6rem 0.3rem","border-bottom":"0.01rem solid #ebebeb"}},[a("van-col",{attrs:{span:"1"}},[e._v(e._s(o+1)+" ")]),a("van-col",{staticStyle:{"border-right":"0.01rem solid #ebebeb"},attrs:{span:"4"}},[e._v(" "+e._s(t.xm)+" ")]),a("van-col",{staticStyle:{"border-right":"0.01rem solid #ebebeb"},attrs:{span:"8"}},[e._v(" "+e._s(t.lxdh)+" ")]),a("van-col",{attrs:{span:"11"}},[e._v(" "+e._s(t.sfzh)+" ")])],1)],1)})),0==e.list.length?a("div",{staticStyle:{"overflow-y":"hidden","margin-top":"2.2rem","font-size":"1rem"}},[e._v(" 未找到记录 ")]):e._e()],2)],1)},f=[],v={name:"Query",data:function(){return{showPopover:!1,labelCode:window.localStorage.getItem("labelCode"),list:[]}},mounted:function(){var e=this;this.$bus.$on("query",(function(){e.labelCode=window.localStorage.getItem("labelCode"),e.onSearch()}))},methods:{onSearch:function(){var e=this;Object(r["a"])({bqbh:this.labelCode,page:1,size:10}).then((function(t){e.list=t.list}))},onCancel:function(){}}},p=v,g=Object(u["a"])(p,b,f,!1,null,null,null),w=g.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-notice-bar",{attrs:{scrollable:!1,wrapable:"",text:"请扫描标签号，或手工录入标签号"}}),a("van-row",[a("van-col",{attrs:{span:"6"}}),a("van-col",{attrs:{span:"12"}})],1),a("van-field",{staticClass:"cjdd",attrs:{readonly:"",label:"采集地点"},scopedSlots:e._u([{key:"button",fn:function(){return[a("van-button",{attrs:{disabled:e.isGathering,size:"small",type:"info",plain:""},on:{click:e.editCjdd}},[e._v("修改地点")])]},proxy:!0}]),model:{value:e.cjdd,callback:function(t){e.cjdd=t},expression:"cjdd"}}),a("van-field",{staticClass:"labelCount",attrs:{type:"number",disabled:e.isGathering,label:"分组数量"},model:{value:e.labelCount,callback:function(t){e.labelCount=t},expression:"labelCount"}}),a("van-field",{staticClass:"labelCode",attrs:{disabled:e.isGathering,required:"",type:"tel",label:"标签内容",clearable:"",placeholder:"请录入或扫描标签码"},model:{value:e.labelCode,callback:function(t){e.labelCode=t},expression:"labelCode"}}),a("van-cell-group",{staticStyle:{padding:"1rem"}},[a("van-row",{staticStyle:{"margin-top":"2rem"},attrs:{type:"flex",justify:"center"}},[a("van-col",{attrs:{span:"18"}},[a("van-button",{attrs:{disabled:e.isGathering,block:"",round:"",plain:"",type:"info"},on:{click:e.doScan}},[e._v("扫描标签")])],1)],1),a("van-row",{staticStyle:{"margin-top":"2rem"},attrs:{type:"flex",justify:"center"}},[a("van-col",{attrs:{span:"18"}},[a("van-button",{attrs:{disabled:e.isGathering,block:"",round:"",type:"primary"},on:{click:e.gotoRegist}},[e._v("开始登记")])],1)],1)],1),a("van-dialog",{attrs:{title:"修改采集地点","show-cancel-button":""},on:{confirm:e.confirmNewCjdd},model:{value:e.showCjdd,callback:function(t){e.showCjdd=t},expression:"showCjdd"}},[a("van-field",{attrs:{clearable:"",placeholder:"请输入采集地点，小于10字"},model:{value:e.newCjdd,callback:function(t){e.newCjdd=t},expression:"newCjdd"}})],1)],1)},$=[],j=a("1602"),x={name:"newLabel",data:function(){return{cjdd:"",newCjdd:"",showCjdd:!1,labelCount:1,labelCode:"",isGathering:!1}},mounted:function(){var e=this;window.vm=this,this.cjdd=window.localStorage.getItem("cjdd")||"",this.labelCode=window.localStorage.getItem("labelCode")||"",this.labelCount=window.localStorage.getItem("labelCount")||5,this.isGathering=this.getGathering(),this.$bus.$on("labelCountChange",(function(t){e.labelCount=t})),this.$bus.$on("labelCodeClear",(function(){window.localStorage.setItem("labelCode",""),e.labelCode=""})),this.$bus.$on("finishGather",(function(){e.isGathering=!1,window.localStorage.setItem("isGathering",0)}))},methods:{getGathering:function(){if(""==this.labelCode)return!1;var e=window.localStorage.getItem("isGathering");if(null==e){var t=window.localStorage.getItem("labelCount"),a=window.localStorage.getItem("labelCounter");t>a&&(e=1)}return 1==e},editCjdd:function(){this.newCjdd=this.cjdd,this.showCjdd=!0},confirmNewCjdd:function(){window.localStorage.setItem("cjdd",this.newCjdd),this.cjdd=this.newCjdd,this.showCjdd=!1},doClear:function(){this.labelCode=""},doScan:function(){var e=this;this.$dialog.alert({message:"原系统中，调起摄像头拍摄试剂盒上的条码，使用”百度条码识别API“，将识别结果填入标签编号，本系统使用模拟数据演示功能"}).then((function(){e.labelCode=Object(j["a"])(8)}))},gotoRegist:function(){""!=this.labelCode?""!=this.cjdd?(this.$emit("switchTab",1),window.localStorage.setItem("isGathering",1),window.localStorage.setItem("labelCode",this.labelCode),window.localStorage.setItem("labelCount",this.labelCount),this.isGathering=!0,this.$bus.$emit("lableCodeChange",this.labelCode)):this.$toast("请选择采集地点"):this.$toast("请录入或扫描标签")}}},y=x,S=(a("07a9"),Object(u["a"])(y,C,$,!1,null,null,null)),z=S.exports,k=0,_={name:"App",components:{Regist:m,Query:w,newLabel:z},data:function(){return{title:["标签管理","核酸检测登记","记录查询","功能设置"],active:0,showMode:!1,showPopover:!1,actions:[{text:"新建标签"},{text:"打印标签"}],form:{mode:"1"},readerIsReady:!1}},watch:{active:function(e){window.localStorage.setItem("active-tab",e),2==e&&this.$bus.$emit("query")}},mounted:function(){var e=this,t=window.sessionStorage.getItem("gather-mode")||"0";console.log("gather-mode",t),document.addEventListener("backbutton",(function(){0==k?(k++,e.$toast("再点一次退出"),setTimeout((function(){k=0}),1e3)):1==k&&navigator.app.exitApp()}),!1)},methods:{serviceNewLabel:function(){},serviceRegist:function(){},handleSwitchTab:function(e){this.active=e},onClickLeft:function(){},confirmMode:function(){window.sessionStorage.setItem("gather-mode",this.form.mode)},selectMenu:function(e,t){},handleNewLabel:function(e){this.active=e},handleClosePrint:function(){}}},q=_,I=Object(u["a"])(q,o,n,!1,null,null,null);t["default"]=I.exports}}]);